# Template: x402 Discovery Endpoint

> Well-known endpoint for x402 v2 agent discovery.

## Template

```typescript
/**
 * x402 Discovery Endpoint
 *
 * Advertises payment-enabled endpoints to AI agents.
 * Generated by Beacon pack.
 *
 * @see https://www.x402.org/writing/x402-v2-launch
 */

import { NextResponse } from 'next/server'

/**
 * x402 v2 Discovery Response
 *
 * Agents fetch this endpoint to learn:
 * - What payment networks are supported
 * - What endpoints are available
 * - Pricing for each endpoint
 */
const DISCOVERY_RESPONSE = {
  version: '2.0',
  capabilities: {
    payments: {
      kinds: ['exact'],
      networks: ['{{NETWORK_ID}}'],
      tokens: ['{{DEFAULT_TOKEN}}']
    },
    extensions: ['discovery', 'receipts', 'subsidy']
  },
  endpoints: [
    {{ENDPOINTS}}
  ],
  metadata: {
    name: '{{SERVICE_NAME}}',
    description: '{{SERVICE_DESCRIPTION}}',
    subsidy: {
      provider: '{{SUBSIDY_PROVIDER}}',
      coverage: '{{SUBSIDY_COVERAGE}}'
    }
  }
}

/**
 * GET /.well-known/x402
 *
 * Returns the discovery response with appropriate caching.
 */
export async function GET() {
  return NextResponse.json(DISCOVERY_RESPONSE, {
    headers: {
      'Cache-Control': 'public, max-age=3600', // Cache for 1 hour
      'X-Payment-Version': '2'
    }
  })
}
```

## Placeholders

| Placeholder | Description | Example |
|-------------|-------------|---------|
| `{{ENDPOINTS}}` | Array of endpoint objects | See below |
| `{{SERVICE_NAME}}` | Human-readable service name | `"YourService"` |
| `{{SERVICE_DESCRIPTION}}` | Brief service description | `"AI image generation and NFT minting"` |
| `{{SUBSIDY_PROVIDER}}` | Entity subsidizing payments | `"{{ORG_NAME}}"` |
| `{{SUBSIDY_COVERAGE}}` | Percentage of coverage | `"50%"` |

## Endpoint Object Structure

```typescript
{
  path: '/api/generate-image',
  method: 'POST',
  description: 'Generate AI image from prompt',
  pricing: {
    amount: '1',
    currency: '{{DEFAULT_TOKEN}}',
    subsidized: true
  },
  schema: '/api/generate-image/schema.json' // Optional
}
```

## Example Endpoints

### Image Generation

```typescript
{
  path: '/api/generate-image',
  method: 'POST',
  description: 'Generate AI image from prompt',
  pricing: { amount: '1', currency: '{{DEFAULT_TOKEN}}', subsidized: true }
}
```

### Image Download

```typescript
{
  path: '/api/download-image',
  method: 'GET',
  description: 'Download generated image by ID',
  pricing: { amount: '0.1', currency: '{{DEFAULT_TOKEN}}', subsidized: true }
}
```

### NFT Minting

```typescript
{
  path: '/api/mint',
  method: 'POST',
  description: 'Mint image as NFT',
  pricing: { amount: '5', currency: '{{DEFAULT_TOKEN}}', subsidized: false }
}
```

## Generated Output Example

```typescript
const DISCOVERY_RESPONSE = {
  version: '2.0',
  capabilities: {
    payments: {
      kinds: ['exact'],
      networks: ['{{NETWORK_ID}}'],
      tokens: ['{{DEFAULT_TOKEN}}']
    },
    extensions: ['discovery', 'receipts', 'subsidy']
  },
  endpoints: [
    {
      path: '/api/generate-image',
      method: 'POST',
      description: 'Generate AI image from prompt',
      pricing: { amount: '1', currency: '{{DEFAULT_TOKEN}}', subsidized: true }
    },
    {
      path: '/api/download-image',
      method: 'GET',
      description: 'Download generated image by ID',
      pricing: { amount: '0.1', currency: '{{DEFAULT_TOKEN}}', subsidized: true }
    },
    {
      path: '/api/mint',
      method: 'POST',
      description: 'Mint image as NFT',
      pricing: { amount: '5', currency: '{{DEFAULT_TOKEN}}', subsidized: false }
    }
  ],
  metadata: {
    name: '{{SERVICE_NAME}}',
    description: 'AI image generation and NFT minting for your project',
    subsidy: {
      provider: '{{SUBSIDY_PROVIDER}}',
      coverage: '50%'
    }
  }
}
```

## Test Command

```bash
# Test the discovery endpoint
curl http://localhost:3000/.well-known/x402 | jq .

# Verify headers
curl -I http://localhost:3000/.well-known/x402
```

## Output Location

`app/.well-known/x402/route.ts`

This follows Next.js App Router conventions for well-known endpoints.
